# 题目 05: TCP 并发聊天室

## 背景
网络编程是后端工程师的基石。虽然 HTTP 很常用，但理解底层的 TCP 通信模型对于处理长连接、即时通讯 (IM) 场景至关重要。

## 需求
实现一个 TCP 聊天室服务器，要求如下：
1.  **监听端口**：在 8080 端口监听 TCP 连接。
2.  **用户管理**：
    *   当新用户连接时，记录其地址（或让用户输入昵称）。
    *   广播消息：“User [Addr] has joined”。
3.  **消息广播**：
    *   任何用户发送的消息，都应该转发给当前在线的所有其他用户。
    *   消息格式简单处理：以换行符 `\n` 为界。
4.  **连接断开**：
    *   当用户断开连接时，从用户列表中移除。
    *   广播消息：“User [Addr] has left”。
5.  **并发安全**：用户列表的访问（添加、删除、遍历发送）必须是线程安全的。

## 考察点
*   `net.Listen`, `net.Conn` 的使用
*   Goroutine 处理每个连接
*   `select` 语句处理多路复用（可选）
*   Channel 广播机制 vs 互斥锁保护 Map
*   TCP 粘包/拆包的基本概念（使用 `bufio.Scanner` 按行读取可简化）

## 提示
*   使用 `map[net.Conn]bool` 或 `map[string]net.Conn` 存储所有客户端。
*   使用一个全局的 `messages` channel 来接收所有客户端发来的消息，并由一个专门的 `broadcaster` goroutine 负责分发给所有客户端。
*   或者使用 `sync.Mutex` 保护客户端 map，在接收到消息时直接遍历 map 发送。
